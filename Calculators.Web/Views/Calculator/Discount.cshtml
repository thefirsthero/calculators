@model Calculators.Web.Models.DiscountCalculatorViewModel
@{
    ViewData["Title"] = "Discount Calculator";
}

<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-percentage"></i> Discount Calculator</h3>
                <p class="mb-0">Calculate discounts, savings, and final prices</p>
            </div>
            <div class="card-body">
                @if (ViewBag.Success == true)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="fas fa-check-circle"></i> Calculation completed successfully!
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                <form asp-action="Discount" method="post" id="discountForm">
                    @Html.AntiForgeryToken()
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="Input.OriginalPrice" class="form-label"></label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input asp-for="Input.OriginalPrice" class="form-control" step="0.01" />
                                </div>
                                <span asp-validation-for="Input.OriginalPrice" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="Input.DiscountPercentage" class="form-label"></label>
                                <div class="input-group">
                                    <input asp-for="Input.DiscountPercentage" class="form-control" step="0.01" />
                                    <span class="input-group-text">%</span>
                                </div>
                                <span asp-validation-for="Input.DiscountPercentage" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-calculator"></i> Calculate
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">
                            <i class="fas fa-undo"></i> Clear
                        </button>
                    </div>
                </form>

                @if (Model.Result != null)
                {
                    <hr />
                    <div class="result-section">
                        <h4><i class="fas fa-chart-line"></i> Calculation Results</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h5 class="card-title text-primary">Original Price</h5>
                                        <p class="card-text h4">$@Model.Result.OriginalPrice.ToString("F2")</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h5 class="card-title text-danger">Discount (@Model.Result.DiscountPercentage%)</h5>
                                        <p class="card-text h4">-$@Model.Result.DiscountAmount.ToString("F2")</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <h5 class="card-title">Final Price</h5>
                                        <p class="card-text h3">$@Model.Result.FinalPrice.ToString("F2")</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-info text-white">
                                    <div class="card-body">
                                        <h5 class="card-title">You Save</h5>
                                        <p class="card-text h3">$@Model.Result.SavingsAmount.ToString("F2")</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 text-muted">
                            <small>Calculated at: @Model.Result.CalculatedAt.ToString("yyyy-MM-dd HH:mm:ss") UTC</small>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function clearForm() {
            document.getElementById('discountForm').reset();
            // Remove any result section
            var resultSection = document.querySelector('.result-section');
            if (resultSection) {
                resultSection.style.display = 'none';
            }
        }

        // Optional: Real-time calculation (uncomment if you want instant results)
        /*
        $(document).ready(function () {
            $('#Input_OriginalPrice, #Input_DiscountPercentage').on('input', function () {
                var originalPrice = parseFloat($('#Input_OriginalPrice').val()) || 0;
                var discountPercentage = parseFloat($('#Input_DiscountPercentage').val()) || 0;

                if (originalPrice > 0 && discountPercentage >= 0 && discountPercentage <= 100) {
                    var input = {
                        OriginalPrice: originalPrice,
                        DiscountPercentage: discountPercentage
                    };

                    $.ajax({
                        url: '@Url.Action("CalculateDiscountAjax", "Calculator")',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(input),
                        success: function (response) {
                            if (response.success) {
                                updateResults(response.result);
                            }
                        }
                    });
                }
            });
        });

        function updateResults(result) {
            // Update result display with AJAX response
            // Implementation depends on your UI preferences
        }
        */
    </script>
}